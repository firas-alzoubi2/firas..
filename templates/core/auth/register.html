{% extends 'base.html' %} {% load crispy_forms_tags %} {% block title %}Register
- Smart Transport{% endblock %} {% block auth_content %}

<div class="auth-container">
  <div class="auth-card" style="max-width: 700px">
    <div class="text-center mb-4">
      <i class="bi bi-bus-front text-primary" style="font-size: 3rem"></i>
      <h2 class="mt-3 mb-1">Create Account</h2>
      <p class="text-muted">Join Smart Transport today</p>
    </div>

    <form method="post" novalidate>
      {% csrf_token %}

      <!-- Row 1: Email and Username -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="id_email" class="form-label">Email</label>
          {{ form.email }} {% if form.email.errors %}
          <div class="invalid-feedback d-block">{{ form.email.errors.0 }}</div>
          {% endif %}
        </div>
        <div class="col-md-6 mb-3">
          <label for="id_username" class="form-label">Username</label>
          {{ form.username }} {% if form.username.errors %}
          <div class="invalid-feedback d-block">
            {{ form.username.errors.0 }}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Row 2: Phone and User Type -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="id_phone" class="form-label">Phone (Optional)</label>
          {{ form.phone }}
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label">I want to register as</label>
          <div class="d-flex gap-4 mt-2">
            {% for radio in form.user_type %}
            <div class="form-check">
              {{ radio.tag }}
              <label class="form-check-label" for="{{ radio.id_for_label }}">
                {% if radio.choice_label == 'Passenger' %}
                <i class="bi bi-person me-1"></i>
                {% else %}
                <i class="bi bi-car-front me-1"></i>
                {% endif %} {{ radio.choice_label }}
              </label>
            </div>
            {% endfor %}
          </div>
          {% if form.user_type.errors %}
          <div class="invalid-feedback d-block">
            {{ form.user_type.errors.0 }}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Row 3: Passwords -->
      <div class="row">
        <div class="col-md-6 mb-3">
          <label for="id_password1" class="form-label">Password</label>
          {{ form.password1 }} {% if form.password1.errors %}
          <div class="invalid-feedback d-block">
            {{ form.password1.errors.0 }}
          </div>
          {% endif %}
        </div>
        <div class="col-md-6 mb-3">
          <label for="id_password2" class="form-label">Confirm Password</label>
          {{ form.password2 }} {% if form.password2.errors %}
          <div class="invalid-feedback d-block">
            {{ form.password2.errors.0 }}
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Driver Specific Fields -->
      <div
        id="driver-fields"
        class="border rounded p-3 mb-3 bg-light"
        style="display: none"
      >
        <h6 class="mb-3 text-primary">
          <i class="bi bi-card-heading me-2"></i>Driver Information
        </h6>
        <div class="row">
          <div class="col-md-4 mb-3">
            <label for="id_license_number" class="form-label"
              >License Number</label
            >
            {{ form.license_number }} {% if form.license_number.errors %}
            <div class="invalid-feedback d-block">
              {{ form.license_number.errors.0 }}
            </div>
            {% endif %}
          </div>
          <div class="col-md-4 mb-3">
            <label for="id_license_type" class="form-label">License Type</label>
            {{ form.license_type }} {% if form.license_type.errors %}
            <div class="invalid-feedback d-block">
              {{ form.license_type.errors.0 }}
            </div>
            {% endif %}
          </div>
          <div class="col-md-4 mb-3">
            <label for="id_license_expiry" class="form-label"
              >License Expiry</label
            >
            {{ form.license_expiry }} {% if form.license_expiry.errors %}
            <div class="invalid-feedback d-block">
              {{ form.license_expiry.errors.0 }}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      {% if form.non_field_errors %}
      <div class="alert alert-danger">
        {% for error in form.non_field_errors %} {{ error }} {% endfor %}
      </div>
      {% endif %}

      <button type="submit" class="btn btn-primary w-100 py-2 mt-3">
        <i class="bi bi-person-plus me-2"></i>Create Account
      </button>
    </form>

    <div class="text-center mt-4">
      <p class="text-muted mb-0">
        Already have an account?
        <a href="{% url 'core:login' %}" class="text-decoration-none"
          >Sign in here</a
        >
      </p>
    </div>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const userTypeInputs = document.querySelectorAll('input[name="user_type"]');
    const driverFields = document.getElementById("driver-fields");

    function toggleDriverFields() {
      let isDriver = false;
      userTypeInputs.forEach((input) => {
        if (input.checked && input.value === "Driver") {
          isDriver = true;
        }
      });

      if (isDriver) {
        driverFields.style.display = "block";
        // Add required attribute to inputs
        driverFields
          .querySelectorAll("input")
          .forEach((input) => (input.required = true));
      } else {
        driverFields.style.display = "none";
        // Remove required attribute
        driverFields
          .querySelectorAll("input")
          .forEach((input) => (input.required = false));
      }
    }

    userTypeInputs.forEach((input) => {
      input.addEventListener("change", toggleDriverFields);
    });

    // Initial check
    toggleDriverFields();
  });
</script>
{% endblock %}
